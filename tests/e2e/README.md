# E2Eテスト

このディレクトリには、OSSトークンプラットフォームのEnd-to-Endテストが含まれています。

**注意**: E2Eテストファイルは`.e2e.ts`拡張子を使用しており、`bun test`実行時には除外されます。

## テスト概要

### 認証とウォレット連携フロー

- **未ログイン状態でのUI表示確認**: ページタイトル、メインタイトル、ステップ表示、GitHubログインボタンの確認
- **GitHubログインボタンクリック**: ログインボタンの存在とクリック可能性の確認
- **ログイン済み状態のモック**: ローカルストレージを使用したモック認証状態のテスト
- **ウォレット連携フローの基本UI**: WalletLinkStepperコンポーネントの表示確認
- **レスポンシブデザインの確認**: モバイル・デスクトップビューポートでのレイアウト確認
- **エラーハンドリングの確認**: ネットワークエラー時の動作確認

### ウォレット連携詳細フロー

- **QRモーダルの表示確認**: 将来的なQRモーダル表示のテスト準備
- **ウォレット連携完了状態の確認**: 将来的な連携完了状態のテスト準備

## テスト実行

### ローカル実行

```bash
# すべてのE2Eテストを実行
bun run e2e-test

# UIモードで実行（デバッグ用）
bun run e2e-test:ui

# ヘッドありモードで実行（ブラウザを表示）
bun run e2e-test:headed
```

### CI環境

GitHub ActionsのCIパイプラインで自動実行されます：

- Chromium
- Firefox
- WebKit

## テスト設定

- **設定ファイル**: `playwright.config.ts`
- **ベースURL**: `http://localhost:3000`
- **タイムアウト**: 5秒
- **リトライ**: CI環境で2回

## テスト結果

最新のテスト実行結果：

- **総テスト数**: 24個
- **成功**: 24個
- **失敗**: 0個

## 今後の拡張予定

1. **実際の認証フロー**: Firebase Authの完全なモック実装
2. **ウォレット連携フロー**: Xaman QRモーダルの表示・操作テスト
3. **API統合テスト**: バックエンドAPIとの連携テスト
4. **パフォーマンステスト**: Lighthouse統合
5. **アクセシビリティテスト**: axe-core統合

## トラブルシューティング

### よくある問題

1. **複数要素エラー**: セレクターが複数の要素にマッチする場合

   - より具体的なセレクターを使用（例: `main.min-h-screen`）

2. **タイムアウトエラー**: 要素の読み込みが遅い場合

   - `waitForTimeout`や`waitForSelector`を使用

3. **認証状態の問題**: Firebase Authのモックが正しく動作しない場合
   - ローカルストレージの設定を確認

### デバッグ方法

```bash
# UIモードでステップバイステップ実行
bun run e2e-test:ui

# 特定のテストのみ実行
bunx playwright test --grep "未ログイン状態"

# ヘッドありモードで実行
bun run e2e-test:headed
```
