# ライセンス発行・証明フローの導入

XRPLをベースとしたOSSライセンス発行・証明機能の導入についての設計およびそのフローに関する技術的判断を記録する。

## ステータス

- Approved

## コンテキスト

オープンソースソフトウェア（OSS）に対してライセンスを発行し、その保有者がライセンスを証明する仕組みを設けたい。トークンをベースとしたエコシステムを構築するにあたって、ライセンストークンを保持しながらライセンスを取得し、そのライセンスを検証可能な形で提示できる機構が求められていた。

## 決定内容

以下のようなフローに基づいてライセンス発行機能を実装する：

1. **ライセンス保有者がライセンストークンを保有**

   - XRPL上のトークン（OSS Token PFで発行したトークン）をウォレットに保持する。

2. **ライセンス発行の依頼**

   - ライセンス保有者がWebプラットフォームからライセンス発行を申請。

3. **ライセンス発行IDの生成と送金要求**

   - ライセンス提供者はライセンス発行IDを生成し、一定のRLUSD/XRP送金を求める。
   - Memoフィールドにライセンス発行IDを含めるよう依頼。

4. **送金トランザクションの実行**

   - ライセンス保有者は、トークンを消費せずに、任意の金額のRLUSDまたはXRPをライセンス提供者に送金。
   - Memoフィールドにライセンス発行IDを含めてXRPLに送信。

5. **送金確認とライセンスキーの発行**

   - ライセンス提供者は送金TXを確認し、Memoと金額を検証。
   - 金額に応じてライセンス期間を決定（計算式は提供者が自由に設計可能）。
   - プラットフォームでライセンスキーを生成し、保有者に提供。

6. **ライセンスキーの提示と検証**

   - OSS側にライセンス検証機能を実装。署名付きライセンスキーを入力とし、正当性（署名、有効期限、対象製品IDなど）を確認可能とする。
   - オフライン環境下ではローカル署名検証、オンライン環境ではAPIを通じた検証も併用可。

このライセンスキーをもとに、OSSプロダクトが適切にライセンスを付与されているか確認可能となる。

## 影響

- **良い影響**:

  - ライセンストークンを消費せず、証明可能なライセンス機構を構築できる
  - オンチェーンとオフチェーンの役割を明確化し、実用的なUXを提供
  - OSSが商用ライセンスやサポートサービス提供へのステップを容易に踏める

- **悪い影響**:

  - ライセンスキーの盗用リスクがあるため、秘密鍵署名・検証の実装が必須
  - プラットフォーム側でのライセンス管理・期間計算の仕組みに一定の実装工数がかかる

## 参照

- [XRPL Transaction Common Fields - Memo](https://xrpl.org/docs/references/protocol/transactions/common-fields/)
- [Xaman SDK Documentation](https://docs.xumm.dev/)
