# プライベートリポジトリ化対応について

OSSプロジェクト登録後にリポジトリがプライベートに変更された場合のシステム対応方針

## ステータス

Proposed-提案

## コンテキスト

本プラットフォームはOSS（オープンソース）プロジェクトのみを対象としており、プロジェクト登録時にはパブリックリポジトリのみが選択可能となっている。しかし、プロジェクト登録後にメンテナーがリポジトリをプライベートに変更する可能性がある。

この場合、以下の課題が発生する：

- OSSプラットフォームとしての信頼性の維持
- 既存の寄付者・トークン保有者への影響
- プラットフォームの透明性確保
- メンテナーへの適切な対応

## 決定内容

### 1. 定期的なリポジトリ状態監視システムの実装

**実装方針:**

- 日次バッチ処理でGitHub APIを使用して全登録プロジェクトのリポジトリ状態をチェック
- プライベート化を検知した場合、プロジェクトステータスを自動的に「一時停止（suspended）」に変更
- メンテナーに自動通知メール送信

**技術実装:**

```typescript
// 新しいバッチ処理API
// src/app/api/admin/check-repositories/route.ts
export async function POST() {
  // 全アクティブプロジェクトを取得
  // GitHub APIでリポジトリ状態をチェック
  // プライベート化されたプロジェクトを「suspended」に変更
  // メンテナーに通知メール送信
}
```

### 2. プロジェクトステータス管理の活用

- 既存の`status`フィールド（`draft`, `active`, `suspended`）を活用
- `suspended`状態では新規寄付受付を停止
- プロジェクト詳細ページに一時停止理由を明記

### 3. 復旧フローの提供

**復旧条件:**

- リポジトリを再度パブリックに変更
- メンテナーがプロジェクト編集画面で「再開申請」
- システムがリポジトリ状態を再確認後、`active`に復旧

### 4. 既存トークンの保護

- **発行済みトークンは維持**（仕様書の「貢献証明」価値を保持）
- プライベート化期間中もトークンの移転・保有は可能
- ユーティリティ機能（優先サポート等）は一時停止

### 5. 透明性の確保

- プロジェクト詳細ページにリポジトリ状態とステータス理由を表示
- 寄付者・トークン保有者への影響を明確に説明
- 復旧見込みや連絡先を提供

## 影響

### 良い影響

- **信頼性の維持**: OSSプラットフォームとしての一貫性を保持
- **投資者保護**: 既存トークン保有者の権益を保護
- **透明性の確保**: 状況変化を明確に伝達
- **柔軟な対応**: 一時的なプライベート化にも対応可能
- **自動化**: 手動監視の負荷を軽減

### 悪い影響

- **システム複雑性の増加**: 監視・通知機能の追加実装が必要
- **GitHub API制限**: 大量のリポジトリチェックによるAPI制限の可能性
- **メンテナー体験**: 一時停止による不便さ
- **運用コスト**: 定期的な監視処理によるリソース消費

### リスク軽減策

- GitHub API制限対策として適切なレート制限とキャッシュ機能を実装
- メンテナーへの事前説明と復旧フローの簡素化
- 監視頻度の調整（日次→週次等）による負荷軽減

## 参照

- [Specification.md](../Specification.md) - プラットフォーム全体仕様
- [MVP.md](../MVP.md) - MVP開発計画
- [GitHub API Documentation](https://docs.github.com/en/rest) - リポジトリ状態取得API
- [Firebase Cloud Functions](https://firebase.google.com/docs/functions) - バッチ処理実装
